apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: user-ms-metises-component
  namespace: argocd
  annotations:
    notifications.argoproj.io/subscribe.on-deployed.slack: monitor
    notifications.argoproj.io/subscribe.on-health-degraded.slack: monitor
    notifications.argoproj.io/subscribe.on-sync-failed.slack: monitor
    notifications.argoproj.io/subscribe.on-sync-running.slack: monitor
    notifications.argoproj.io/subscribe.on-sync-status-unknown.slack: monitor
    notifications.argoproj.io/subscribe.on-sync-succeeded.slack: monitor
    argocd-image-updater.argoproj.io/write-back-method: argocd
    argocd-image-updater.argoproj.io/image-list: 'ms-user-api-unstable=us-docker.pkg.dev/metises-com/metises/ms-user, ms-user-cmd-unstable=us-docker.pkg.dev/metises-com/metises/ms-user'
    argocd-image-updater.argoproj.io/ms-user-api-unstable.update-strategy: latest
    argocd-image-updater.argoproj.io/ms-user-api-unstable.allow-tags: regexp:^api-unstable-[0-9a-zA-Z]+$
    argocd-image-updater.argoproj.io/ms-user-api-unstable.helm.image-name: services.api.image.name
    argocd-image-updater.argoproj.io/ms-user-api-unstable.helm.image-tag: services.api.image.tag
    argocd-image-updater.argoproj.io/ms-user-cmd-unstable.update-strategy: latest
    argocd-image-updater.argoproj.io/ms-user-cmd-unstable.allow-tags: regexp:^cmd-unstable-[0-9a-zA-Z]+$
    argocd-image-updater.argoproj.io/ms-user-cmd-unstable.helm.image-name: services.cmd.image.name
    argocd-image-updater.argoproj.io/ms-user-cmd-unstable.helm.image-tag: services.cmd.image.tag
spec:
  project: default
  source:
    chart: metises-component
    repoURL: https://timgchile.github.io/helmcharts
    targetRevision: 1.0.31
    helm:
      releaseName: user-ms-metises-component
      values: |
        name: ms-user
        version: unstable
        kind: microservice
        env: test
        hpa:
          memory: 80
          cpu: 80
          minReplicas: 2
          maxReplicas: 3
        resources:
          requests:
            memory: 300Mi
            cpu: 100m
          limits:
            memory: 300Mi
            cpu: 100m
        tolerations:
          preemptible: "yes"
        envs:
          TRUSTED_PROXIES: "127.0.0.1,34.73.0.182"
        secrets:
          default:
            path: /var/www/framework/.env
        services:
          api:
            image:
              name: us-docker.pkg.dev/metises-com/metises/ms-user
              tag: api-unstable
            publicRoutes:
              main:
                domain: api-test.metises.com
                paths:
                  - healthcheck
                  - users
                  - tokens
            internalRoutes: {}
          cmd:
            image:
              name: us-docker.pkg.dev/metises-com/metises/ms-user
              tag: cmd-unstable
  destination:
    server: https://kubernetes.default.svc
    namespace: ms-user
